(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(t){if(t.ep)return;t.ep=!0;const e=s(t);fetch(t.href,e)}})();function _(o,a,s,i,t){const e=o.canvas.width,r=o.canvas.height,u=o.getImageData(0,0,e,r),V=a.getImageData(0,0,e,r),p=s.createImageData(e,r);s.canvas.width!==e&&(s.canvas.width=e),s.canvas.height!==r&&(s.canvas.height=r);const l=u.data,b=V.data,c=p.data;let I=0,U=0;for(let n=0;n<l.length;n+=4){const K=l[n],J=l[n+1],Q=l[n+2],X=b[n],Y=b[n+1],Z=b[n+2],w=Math.abs(K-X),C=Math.abs(J-Y),L=Math.abs(Q-Z),A=(w+C+L)/3;U+=A*A;const k=w>t||C>t||L>t;switch(k&&I++,i){case"highlight":k?(c[n]=239,c[n+1]=68,c[n+2]=68,c[n+3]=255):(c[n]=Math.round(l[n]*.6),c[n+1]=Math.round(l[n+1]*.6),c[n+2]=Math.round(l[n+2]*.6),c[n+3]=255);break;case"heatmap":{const D=Math.min(255,Math.max(0,Math.floor(A)));c[n]=D,c[n+1]=Math.min(80,Math.floor(D*.3)),c[n+2]=255-D,c[n+3]=255;break}case"diffRGB":c[n]=w,c[n+1]=C,c[n+2]=L,c[n+3]=255;break}}s.putImageData(p,0,0);const g=e*r,q=g?I/g*100:0,E=g?U/g:0,G=E===0?1/0:20*Math.log10(255)-10*Math.log10(E);return{imageData:p,metrics:{width:e,height:r,diffPixelsCount:I,totalPixels:g,diffPixelsPct:q,mse:E,psnr:G}}}async function F(o){const a=URL.createObjectURL(o),s=new Image;return await new Promise((i,t)=>{s.onload=()=>i(),s.onerror=t,s.src=a}),URL.revokeObjectURL(a),s}function v(o,a,s,i){const t=s??a.naturalWidth,e=i??a.naturalHeight;o.canvas.width=t,o.canvas.height=e,o.clearRect(0,0,t,e),o.drawImage(a,0,0,t,e)}const H=document.getElementById("fileA"),N=document.getElementById("fileB"),tt=document.getElementById("resizeToA"),B=document.getElementById("tolerance"),W=document.getElementById("tolVal"),et=document.getElementById("mode"),P=document.getElementById("btnCompare"),$=document.getElementById("btnDownload"),nt=document.getElementById("canvasA"),at=document.getElementById("canvasB"),z=document.getElementById("canvasDiff"),M=nt.getContext("2d"),R=at.getContext("2d"),x=z.getContext("2d"),O=document.getElementById("overlay"),S=document.getElementById("imgA"),h=document.getElementById("imgB"),j=document.getElementById("slider"),f=document.getElementById("btnBlink"),ot=document.getElementById("mDims"),st=document.getElementById("mPct"),ct=document.getElementById("mMSE"),it=document.getElementById("mPSNR"),rt=document.getElementById("mDiffCount");let d=null,m=null,y=null;W.textContent=B.value;B.addEventListener("input",()=>W.textContent=B.value);async function T(){var s,i;const o=(s=H.files)==null?void 0:s[0],a=(i=N.files)==null?void 0:i[0];if(!o||!a){P.disabled=!0,f.disabled=!0,O.setAttribute("data-state","empty"),S.removeAttribute("src"),h.removeAttribute("src");return}try{d=await F(o),m=await F(a),v(M,d),v(R,m),S.src=URL.createObjectURL(o),h.src=URL.createObjectURL(a),O.setAttribute("data-state","ready"),P.disabled=!1,f.disabled=!1}catch(t){alert("Помилка завантаження зображення: "+t)}}H.addEventListener("change",T);N.addEventListener("change",T);P.addEventListener("click",async()=>{if(!d||!m)return;const o=d.naturalWidth===m.naturalWidth&&d.naturalHeight===m.naturalHeight;let a=d.naturalWidth,s=d.naturalHeight,i=m;if(!o)if(tt.checked){const e=document.createElement("canvas");e.width=a,e.height=s,e.getContext("2d").drawImage(m,0,0,a,s);const u=new Image;u.src=e.toDataURL(),await u.decode(),i=u}else{alert("Різні розміри. Увімкніть підгонку B під A або підготуйте однакові зображення.");return}v(M,d,a,s),v(R,i,a,s),x.canvas.width=a,x.canvas.height=s;const t=_(M,R,x,et.value,parseInt(B.value,10));ot.textContent=`${t.metrics.width} × ${t.metrics.height}`,st.textContent=`${t.metrics.diffPixelsPct.toFixed(2)}%`,ct.textContent=t.metrics.mse.toFixed(2),it.textContent=Number.isFinite(t.metrics.psnr)?t.metrics.psnr.toFixed(2):"∞",rt.textContent=`${t.metrics.diffPixelsCount.toLocaleString()} px`,$.disabled=!1});$.addEventListener("click",()=>{const o=z.toDataURL("image/png"),a=document.createElement("a");a.href=o,a.download="diff.png",a.click()});j.addEventListener("input",()=>{const o=parseInt(j.value,10);h.style.clipPath=`inset(0 ${100-o}% 0 0)`});f.addEventListener("click",()=>{if(y!==null){window.clearInterval(y),y=null,f.textContent="Миготіти A/B",h.style.opacity="1";return}f.textContent="Зупинити миготіння";let o=!0;y=window.setInterval(()=>{o=!o,h.style.opacity=o?"1":"0"},500)});
